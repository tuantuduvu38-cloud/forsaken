<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Wordscape - Level 1</title>
<style>
  body {
    margin: 0;
    font-family: 'Poppins', sans-serif;
    height: 100vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
    background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1600&q=80') no-repeat center center/cover;
  }

  .overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    background: rgba(0, 50, 100, 0.35);
    top: 0;
    left: 0;
    z-index: 0;
  }

  .board {
    position: relative;
    z-index: 2;
    width: 320px;
    text-align: center;
    color: white;
    margin-bottom: 80px;
  }

  .word-slot {
    display: flex;
    justify-content: center;
    gap: 5px;
    margin-bottom: 20px;
  }

  .slot {
    width: 50px;
    height: 50px;
    border-bottom: 3px solid rgba(255,255,255,0.6);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 28px;
    font-weight: bold;
    color: transparent;
    transition: 0.3s;
  }

  .slot.filled {
    color: #fff;
    text-shadow: 0 0 10px #33ccff;
  }

  canvas {
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
  }

  .letters {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 25px;
    position: relative;
    z-index: 2;
    margin-bottom: 60px;
  }

  .letter {
    width: 65px;
    height: 65px;
    border-radius: 50%;
    background: radial-gradient(circle at top left, #33ccff, #0066cc);
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 32px;
    font-weight: bold;
    color: white;
    cursor: pointer;
    box-shadow: 0 0 10px #33ccff;
    transition: transform 0.2s, box-shadow 0.2s;
  }

  .letter.active {
    transform: scale(1.2);
    box-shadow: 0 0 20px #99e6ff;
  }

  .controls {
    position: relative;
    z-index: 2;
    margin-bottom: 30px;
  }

  button {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.4);
    color: white;
    font-size: 16px;
    padding: 8px 16px;
    border-radius: 10px;
    cursor: pointer;
    transition: 0.3s;
  }

  button:hover {
    background: rgba(255,255,255,0.4);
  }

  .popup {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(0,0,0,0.7);
    color: white;
    font-size: 36px;
    font-weight: bold;
    display: none;
    flex-direction: column;
    z-index: 10;
  }

  .popup button {
    margin-top: 20px;
  }
</style>
</head>
<body>
<div class="overlay"></div>
<canvas id="lineCanvas"></canvas>

<div class="board">
  <div id="word1" class="word-slot">
    <div class="slot"></div>
    <div class="slot"></div>
    <div class="slot"></div>
    <div class="slot"></div>
  </div>
</div>

<div class="letters" id="letters"></div>

<div class="controls">
  <button id="shuffleBtn">Shuffle</button>
</div>

<div class="popup" id="popup">
  <div>LEVEL COMPLETE!</div>
  <button onclick="location.reload()">Next Level</button>
</div>

<audio id="bgMusic" src="https://cdn.pixabay.com/download/audio/2022/03/14/audio_2f558a4f35.mp3?filename=relaxing-music-ambient-110397.mp3" loop></audio>
<audio id="ding" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_8f0339c7c3.mp3?filename=correct-2-46134.mp3"></audio>

<script>
const lettersContainer = document.getElementById('letters');
const canvas = document.getElementById('lineCanvas');
const ctx = canvas.getContext('2d');
const slots = document.querySelectorAll('.slot');
const popup = document.getElementById('popup');
const bgMusic = document.getElementById('bgMusic');
const ding = document.getElementById('ding');

const validWords = ["WORD", "ROW", "OR", "DO"];
const letters = ["W", "O", "R", "D"];

let currentWord = "";
let usedWords = [];
let letterElements = [];
let dragging = false;
let lastPos = null;

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

bgMusic.volume = 0.4;
bgMusic.play().catch(()=>{});

function drawLine(from, to) {
  ctx.beginPath();
  ctx.moveTo(from.x, from.y);
  ctx.lineTo(to.x, to.y);
  ctx.strokeStyle = "rgba(0,200,255,0.8)";
  ctx.lineWidth = 6;
  ctx.shadowBlur = 10;
  ctx.shadowColor = "#33ccff";
  ctx.stroke();
}

function clearLines() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function shuffle() {
  for (let i = letters.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [letters[i], letters[j]] = [letters[j], letters[i]];
  }
  renderLetters();
}

function renderLetters() {
  lettersContainer.innerHTML = "";
  letters.forEach(letter => {
    const el = document.createElement("div");
    el.className = "letter";
    el.textContent = letter;
    lettersContainer.appendChild(el);
    letterElements.push(el);
  });
}

function resetSlots() {
  slots.forEach(s => {
    s.textContent = "";
    s.classList.remove("filled");
  });
}

lettersContainer.addEventListener("mousedown", e => {
  if (e.target.classList.contains("letter")) {
    dragging = true;
    currentWord = "";
    clearLines();
    lastPos = e.target.getBoundingClientRect();
    e.target.classList.add("active");
    currentWord += e.target.textContent;
  }
});

window.addEventListener("mousemove", e => {
  if (!dragging) return;
  clearLines();
  const activeLetters = document.querySelectorAll('.letter.active');
  let lastBox = null;
  activeLetters.forEach((l, i) => {
    const rect = l.getBoundingClientRect();
    const mid = { x: rect.x + rect.width/2, y: rect.y + rect.height/2 };
    if (i > 0) drawLine(lastBox, mid);
    lastBox = mid;
  });
  drawLine(lastBox, {x: e.clientX, y: e.clientY});
});

window.addEventListener("mouseup", e => {
  if (!dragging) return;
  dragging = false;
  clearLines();
  const activeLetters = document.querySelectorAll('.letter.active');
  currentWord = Array.from(activeLetters).map(l => l.textContent).join("");
  activeLetters.forEach(l => l.classList.remove("active"));

  if (validWords.includes(currentWord) && !usedWords.includes(currentWord)) {
    ding.play();
    usedWords.push(currentWord);
    const slotRow = document.getElementById("word1").querySelectorAll('.slot');
    if (currentWord === "WORD") {
      slotRow.forEach((s, i) => {
        s.textContent = currentWord[i];
        s.classList.add("filled");
      });
    }
  }

  if (usedWords.includes("WORD") && usedWords.includes("ROW") && usedWords.includes("OR") && usedWords.includes("DO")) {
    setTimeout(()=> popup.style.display="flex", 500);
  }
});

document.getElementById('shuffleBtn').addEventListener('click', shuffle);
renderLetters();
</script>
</body>
</html>
