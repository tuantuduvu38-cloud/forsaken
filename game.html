<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Forsaken - Gameplay</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
      color: white;
      font-family: monospace;
    }
    #timer {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(0,0,0,0.5);
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 20px;
      color: #00ff99;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: radial-gradient(circle at center, #101010, #000);
    }
  </style>
</head>
<body>
  <div id="timer">⏱ 03:50</div>
  <canvas id="gameCanvas" width="900" height="600"></canvas>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const timerDisplay = document.getElementById('timer');

    // Timer setup
    let time = 3 * 60 + 50; // 3m50s
    setInterval(() => {
      if (time > 0) time--;
      const m = Math.floor(time / 60);
      const s = String(time % 60).padStart(2, '0');
      timerDisplay.textContent = `⏱ ${m}:${s}`;
    }, 1000);

    // Player setup
    const player = { x: 450, y: 300, r: 14, color: 'deepskyblue', speed: 3 };
    const keys = {};

    // Mobs
    const mobs = [];
    const totalMobs = 8;
    const killerIndex = Math.floor(Math.random() * totalMobs);
    for (let i = 0; i < totalMobs; i++) {
      mobs.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        r: 14,
        color: i === killerIndex ? 'red' : 'limegreen',
      });
    }

    // Random walls
    const walls = [];
    const wallCount = 8 + Math.floor(Math.random() * 5); // 8–12 walls
    for (let i = 0; i < wallCount; i++) {
      const w = 50 + Math.random() * 80;
      const h = 30 + Math.random() * 70;
      walls.push({
        x: Math.random() * (canvas.width - w),
        y: Math.random() * (canvas.height - h),
        w, h,
        color: '#555'
      });
    }

    // Input control
    window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    function movePlayer() {
      let dx = 0, dy = 0;
      if (keys['w']) dy -= player.speed;
      if (keys['s']) dy += player.speed;
      if (keys['a']) dx -= player.speed;
      if (keys['d']) dx += player.speed;

      const nextX = player.x + dx;
      const nextY = player.y + dy;

      if (!collides(nextX, nextY, player.r)) {
        player.x = nextX;
        player.y = nextY;
      }
    }

    function collides(px, py, r) {
      for (const wall of walls) {
        if (px + r > wall.x && px - r < wall.x + wall.w &&
            py + r > wall.y && py - r < wall.y + wall.h) {
          return true;
        }
      }
      return false;
    }

    function moveMobs() {
      mobs.forEach(m => {
        m.x += (Math.random() - 0.5) * 1.5;
        m.y += (Math.random() - 0.5) * 1.5;
        m.x = Math.max(m.r, Math.min(canvas.width - m.r, m.x));
        m.y = Math.max(m.r, Math.min(canvas.height - m.r, m.y));
      });
    }

    function drawCircle(e) {
      ctx.beginPath();
      ctx.arc(e.x, e.y, e.r, 0, Math.PI * 2);
      ctx.fillStyle = e.color;
      ctx.fill();
    }

    function drawWalls() {
      walls.forEach(w => {
        ctx.fillStyle = w.color;
        ctx.fillRect(w.x, w.y, w.w, w.h);
      });
    }

    function render() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawWalls();
      drawCircle(player);
      mobs.forEach(drawCircle);
    }

    function loop() {
      movePlayer();
      moveMobs();
      render();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>
